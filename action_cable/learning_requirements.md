# 学習要件定義書 - Action Cable

## 1. 学習目的
- WebSocketベースのリアルタイム通信をRailsアプリケーションで実装する方法を理解する
- Action Cableのアーキテクチャ（Connection、Channel、Consumer）の関係性を把握する
- リアルタイムチャット、ライブ更新、通知システムなどの実装パターンを習得する
- パフォーマンスとスケーラビリティの考慮点を理解する

## 2. 既知と未知
### 2.1 既知
- WebSocketの基本概念（双方向通信、持続的接続）
- Railsの基本的なMVCパターン
- JavaScriptの基本的な非同期処理

### 2.2 未知・疑問点
- Action CableのConnection、Channel、Consumerの具体的な役割と連携方法
- サーバーサイドからクライアントへのプッシュ通知の実装方法
- 複数のユーザー間でのリアルタイムデータ共有の仕組み
- Redis等のアダプターの必要性と設定方法
- 認証・認可の実装方法（特定のユーザーのみにメッセージ送信）
- パフォーマンスの最適化手法
- テストの書き方

## 3. 仮説と検証方針
| 疑問/仮説 | どのコード/資料で確認する？ | 検証方法 | 完了基準 |
|-----------|------------------------------|----------|----------|
| ConnectionクラスがWebSocket接続を管理している | actioncable/lib/action_cable/connection/ | 実際のConnectionクラスのコードを読む | Connection.Base の役割と接続フローを説明できる |
| ChannelクラスがビジネスロジックとWebSocketを橋渡ししている | actioncable/lib/action_cable/channel/ | Channel.Base のメソッドを確認 | チャンネルの購読・配信の流れを図解できる |
| フロントエンドのConsumerが接続を管理している | actioncable/app/assets/javascripts/ | JavaScriptコードの動作確認 | Consumer APIの使い方を説明できる |
| Redisアダプターで複数サーバー間の通信を行う | actioncable/lib/action_cable/subscription_adapter/ | アダプターの実装を確認 | アダプターの役割と設定方法を説明できる |
| 認証はConnectionレベルで行われる | examples や test ディレクトリ | 認証実装例を確認 | 認証フローを実装できる |

## 4. 優先度と学習順序
1. **基本アーキテクチャの理解**（Connection、Channel、Consumer の関係）
2. **シンプルなチャット機能の実装理解**（基本的な送受信）
3. **認証・認可機能の実装方法**
4. **アダプター（Redis等）の設定と役割**
5. **パフォーマンス最適化とスケーラビリティ**
6. **テスト実装方法**

## 5. 期待アウトプット・定着方法
- Action Cableのアーキテクチャ図（Connection、Channel、Consumer の関係）
- シンプルなリアルタイムチャットの実装サンプル
- 認証付きのリアルタイム通知システムのコード例
- パフォーマンス考慮点をまとめたチェックリスト
- Action Cableのテスト実装例

## 6. リスク/詰まりポイントと回避策
- **WebSocket接続が不安定**: ネットワーク環境やプロキシの影響 → ローカル開発環境での動作確認から開始
- **Redisの設定で詰まる**: アダプターの設定が複雑 → まずはAsyncアダプターで基本動作を確認
- **フロントエンドとの連携**: JavaScriptの非同期処理で混乱 → サーバーサイドの理解を先に固める
- **認証の実装**: セッション管理とWebSocketの組み合わせが複雑 → シンプルな認証から段階的に実装
- **メモリリーク**: 接続の適切な切断処理 → テストコードでリソース管理を確認