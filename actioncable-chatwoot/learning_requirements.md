# 学習要件定義書 - ChatwootにおけるActionCableの実装

## 1. 学習目的
- ChatwootでのActionCableの実装パターンと設計思想を理解する
- リアルタイム通信の具体的な実装方法を習得する
- フロントエンド（Vue.js）とバックエンド（Rails）の連携方法を学ぶ
- Chatwootの機能要件に対してActionCableがどう活用されているかを把握する
- 実際のプロダクションレベルでのActionCable実装のベストプラクティスを学ぶ

## 2. 既知と未知
### 2.1 既知
- ActionCableの基本概念（Channel、Connection、Consumer）
- WebSocketの基本的な仕組み
- Railsアプリケーションの基本構造
- Vue.jsの基本的な使い方

### 2.2 未知・疑問点
- Chatwootでどのような場面でActionCableが使われているか？
- チャンネルの設計方針と実装パターン
- 認証・認可の実装方法
- フロントエンドでのActionCableクライアントの実装
- メッセージのブロードキャスト方法と範囲制御
- エラーハンドリングと接続管理
- スケーラビリティを考慮した実装
- テスト方法

## 3. 仮説と検証方針
| 疑問/仮説 | どのコード/資料で確認する？ | 検証方法 | 完了基準 |
|-----------|------------------------------|----------|----------|
| リアルタイムメッセージ送信に使用されている | `app/channels/` ディレクトリ, メッセージ関連のコントローラー | コードリーディング、実際の動作確認 | メッセージ送信フローを図解できる |
| エージェントの在席状況表示に使用されている | presence関連のチャンネル、フロントエンドのコンポーネント | コードリーディング、ブラウザでの動作確認 | 在席状況の更新メカニズムを説明できる |
| 通知機能で使用されている | notification関連のチャンネル | コードリーディング、通知発生時の動作確認 | 通知の配信ロジックを理解している |
| 認証はDevise Token Authと連携している | `app/channels/application_cable/connection.rb` | コードリーディング | 認証フローを説明できる |
| フロントエンドはVue.jsで実装されている | `app/javascript/` 内のActionCable関連コード | コードリーディング、ブラウザデベロッパーツール | クライアント側の実装を理解している |

## 4. 優先度と学習順序
1. **最優先**: ActionCableの基本構成とConnection/Channelの実装確認
2. **次点**: メッセージ送受信の具体的な実装とフロー
3. **3番目**: 認証・認可の実装方法
4. **4番目**: フロントエンド（Vue.js）側の実装
5. **5番目**: エラーハンドリングとテスト実装
6. **最後**: パフォーマンスとスケーラビリティの考慮事項

## 5. 期待アウトプット・定着方法
- **理解マップ**: ChatwootのActionCable実装全体の構成図
- **フローチャート**: メッセージ送受信、在席状況更新等の処理フロー図
- **実装ノート**: 各チャンネルの役割と実装ポイントのまとめ
- **サンプルコード**: 学習した内容を基にした簡単なActionCable実装例
- **質問リスト**: 実装時に考慮すべきポイントのチェックリスト

## 6. リスク/詰まりポイントと回避策
- **WebSocket接続の複雑さ**: 実際のブラウザでデベロッパーツールを使って接続状況を確認する
- **認証フローの理解不足**: Devise Token Authのドキュメントも並行して確認する
- **フロントエンドとバックエンドの連携**: 実際にメッセージを送信して動作を確認する
- **コードベースが大きすぎて迷子になる**: 特定の機能（例：メッセージ送信）に絞って追跡する
- **ActionCableの設定ファイルの見落とし**: `config/cable.yml`, `config/routes.rb`等の設定も確認する

## 7. 次のアクション
学習要件定義完了後：
1. ChatwootのActionCable関連ファイルの全体像把握
2. 具体的なチャンネル実装の詳細分析
3. フロントエンド連携部分の実装確認
4. 学習内容の整理とドキュメント作成